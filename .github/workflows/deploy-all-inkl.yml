name: Deploy retype to all-inkl

on:
  workflow_run:
    workflows: ["Publish Retype powered website to retype branch"]
    types:
      - completed

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Update /retype on server
        uses: appleboy/ssh-action@master
        with:
          host: w01c4ca9.kasserver.com
          username: ssh-w02125c1
          key: ${{ secrets.SSH_KEY }}
          script: |
            set -e
            cd /www/htdocs/w02125c1/website

            git fetch --all

            # Worktree f√ºr retype anlegen, falls noch nicht vorhanden
            if [ ! -d "retype/.git" ]; then
              rm -rf retype
              git worktree add retype retype
            fi

            cd retype
            git pull origin retype
